<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçï PizzaExpress - Il Tuo Negozio</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; }
        body { background: #0a0a0a; min-height: 100vh; color: #fff; }
        
        /* Header */
        .header { background: linear-gradient(135deg, #ff6b35, #f7931e); padding: 20px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 4px 20px rgba(255,107,53,0.3); }
        .header h1 { font-size: 24px; font-weight: 800; letter-spacing: -0.5px; }
        .header p { font-size: 12px; opacity: 0.9; margin-top: 5px; }
        
        /* Banner */
        .banner { background: linear-gradient(135deg, #1a1a2e, #16213e); padding: 30px 20px; text-align: center; margin: 15px; border-radius: 20px; }
        .banner h2 { font-size: 28px; margin-bottom: 10px; }
        .banner .discount { background: #ff6b35; padding: 5px 15px; border-radius: 20px; font-weight: bold; font-size: 14px; }
        
        /* Categories */
        .categories { display: flex; gap: 10px; padding: 0 15px; overflow-x: auto; padding-bottom: 10px; }
        .category { background: #1a1a1a; padding: 10px 20px; border-radius: 25px; white-space: nowrap; font-size: 13px; cursor: pointer; transition: all 0.3s; }
        .category.active { background: #ff6b35; color: #fff; }
        
        /* Products */
        .products { display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; padding: 15px; padding-bottom: 100px; }
        .product { background: #151515; border-radius: 20px; overflow: hidden; transition: transform 0.3s, box-shadow 0.3s; }
        .product:active { transform: scale(0.97); }
        .product-img { width: 100%; height: 130px; object-fit: cover; background: #1a1a1a; }
        .product-info { padding: 15px; }
        .product-name { font-size: 15px; font-weight: 700; margin-bottom: 5px; }
        .product-desc { font-size: 11px; color: #666; margin-bottom: 10px; line-height: 1.4; }
        .product-bottom { display: flex; justify-content: space-between; align-items: center; }
        .product-price { font-size: 18px; font-weight: 800; color: #ff6b35; }
        .product-btn { background: #ff6b35; color: #fff; border: none; padding: 8px 15px; border-radius: 20px; font-weight: 600; font-size: 12px; cursor: pointer; }
        
        .empty { grid-column: span 2; text-align: center; padding: 50px; color: #666; }
        
        /* Cart Button */
        .cart-btn { position: fixed; bottom: 20px; right: 20px; background: linear-gradient(135deg, #ff6b35, #f7931e); color: #fff; border: none; padding: 15px 25px; border-radius: 50px; font-weight: 700; font-size: 14px; box-shadow: 0 4px 25px rgba(255,107,53,0.5); display: flex; align-items: center; gap: 8px; }
        .cart-badge { background: #fff; color: #ff6b35; border-radius: 50%; width: 22px; height: 22px; font-size: 12px; display: flex; align-items: center; justify-content: center; font-weight: 800; }
        
        /* Admin Button */
        .admin-btn { position: fixed; bottom: 20px; left: 20px; background: #1a1a1a; border: 2px solid #333; width: 50px; height: 50px; border-radius: 50%; font-size: 18px; display: flex; align-items: center; justify-content: center; }
        
        /* Modal */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #0a0a0a; z-index: 200; overflow-y: auto; }
        .modal.active { display: block; }
        .modal-content { padding: 20px; padding-bottom: 40px; }
        .modal-header { background: linear-gradient(135deg, #ff6b35, #f7931e); padding: 15px 20px; text-align: center; position: sticky; top: 0; display: flex; justify-content: space-between; align-items: center; }
        .modal-header h2 { font-size: 18px; }
        .modal-header button { background: none; border: none; color: #fff; font-size: 24px; cursor: pointer; }
        
        /* Form */
        .form-group { margin-bottom: 15px; }
        .form-group label { display: block; color: #888; font-size: 12px; margin-bottom: 5px; }
        .form-group input, .form-group textarea { width: 100%; padding: 14px; background: #151515; border: 1px solid #333; border-radius: 12px; color: #fff; font-size: 14px; }
        .form-group textarea { resize: none; height: 80px; }
        
        .img-upload { width: 100%; height: 100px; background: #151515; border: 2px dashed #333; border-radius: 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #666; }
        
        /* Buttons */
        .btn { width: 100%; padding: 15px; border: none; border-radius: 12px; font-size: 14px; font-weight: 700; margin-bottom: 10px; cursor: pointer; }
        .btn-orange { background: linear-gradient(135deg, #ff6b35, #f7931e); color: #fff; }
        .btn-green { background: #10b981; color: #fff; }
        .btn-blue { background: #3b82f6; color: #fff; }
        .btn-red { background: #ef4444; color: #fff; }
        .btn-gray { background: #333; color: #fff; }
        
        /* Cart Items */
        .cart-item { background: #151515; padding: 15px; border-radius: 15px; margin-bottom: 12px; display: flex; justify-content: space-between; align-items: center; }
        .cart-item-info { flex: 1; }
        .cart-item-name { font-weight: 700; font-size: 14px; }
        .cart-item-price { color: #ff6b35; font-weight: 600; }
        .cart-total { font-size: 22px; font-weight: 800; text-align: center; padding: 20px; background: #151515; border-radius: 15px; margin: 20px 0; }
        
        /* Orders */
        .order-card { background: #151515; border-radius: 15px; padding: 15px; margin-bottom: 15px; }
        .order-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .order-id { font-weight: 700; color: #ff6b35; }
        .order-status { padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 600; }
        .status-new { background: #f59e0b; color: #000; }
        .status-processing { background: #3b82f6; color: #fff; }
        .status-completed { background: #10b981; color: #fff; }
        
        .order-items { font-size: 13px; color: #aaa; margin-bottom: 10px; }
        .order-customer { font-size: 12px; color: #666; }
        .order-customer strong { color: #fff; }
        .order-actions { display: flex; gap: 8px; margin-top: 12px; }
        
        /* Product List Admin */
        .product-list-admin { margin-top: 20px; }
        .product-item { background: #151515; padding: 12px; border-radius: 12px; margin-bottom: 10px; display: flex; align-items: center; gap: 12px; }
        .product-item img { width: 50px; height: 50px; border-radius: 10px; object-fit: cover; }
        .product-item-info { flex: 1; }
        .product-item-name { font-size: 14px; font-weight: 700; }
        .product-item-price { color: #ff6b35; font-size: 14px; font-weight: 600; }
        .product-item-actions { display: flex; gap: 5px; }
        .product-item-actions button { padding: 8px 12px; font-size: 11px; border-radius: 8px; border: none; cursor: pointer; }
        
        /* Tabs */
        .tab-buttons { display: flex; gap: 10px; margin-bottom: 15px; }
        .tab-btn { flex: 1; padding: 12px; background: #1a1a1a; border: none; border-radius: 10px; color: #fff; font-size: 13px; font-weight: 600; cursor: pointer; }
        .tab-btn.active { background: #ff6b35; }
        
        .empty-orders { text-align: center; padding: 40px; color: #666; }
        
        /* Badge */
        .badge { background: #ef4444; color: #fff; border-radius: 50%; width: 20px; height: 20px; font-size: 11px; display: flex; align-items: center; justify-content: center; position: absolute; top: -8px; right: -8px; }
        
        /* Success */
        .success-content { text-align: center; padding-top: 60px; }
        .success-icon { font-size: 80px; }
        .success-title { font-size: 24px; font-weight: 700; margin: 20px 0; }
        .success-msg { color: #666; margin-bottom: 30px; }
    </style>
</head>
<body>
    <!-- HEADER -->
    <div class="header">
        <h1>üçï PizzaExpress</h1>
        <p>Pizzeria & Fast Food ‚Ä¢ Consegna a domicilio</p>
    </div>
    
    <!-- BANNER -->
    <div class="banner">
        <h2>üéâ Benvenuto!</h2>
        <p style="color:#aaa;margin-bottom:15px;">Ordina la tua pizza preferita</p>
        <span class="discount">üéÅ Primo ordine -10%</span>
    </div>
    
    <!-- CATEGORIES -->
    <div class="categories">
        <div class="category active" onclick="filterCat('all')">üçï Tutte</div>
        <div class="category" onclick="filterCat('pizza')">üçï Pizza</div>
        <div class="category" onclick="filterCat('burger')">üçî Hamburger</div>
        <div class="category" onclick="filterCat('drink')">ü•§ Bibite</div>
        <div class="category" onclick="filterCat('dessert')">üç∞ Dolci</div>
    </div>
    
    <!-- PRODUCTS -->
    <div class="products" id="products"></div>
    
    <!-- BUTTONS -->
    <button class="admin-btn" onclick="openAdmin()">‚öôÔ∏è</button>
    <button class="cart-btn" onclick="openCart()">
        üõí Carrello
        <span class="cart-badge" id="cartCount">0</span>
    </button>
    
    <!-- CART MODAL -->
    <div class="modal" id="cartModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üõí Il Tuo Carrello</h2>
                <button onclick="closeCart()">√ó</button>
            </div>
            <div id="cartItems"></div>
            <div class="cart-total" id="cartTotal">Totale: ‚Ç¨0.00</div>
            <button class="btn btn-green" onclick="openCheckout()">‚úÖ VAI AL PAGAMENTO</button>
            <button class="btn btn-gray" onclick="closeCart()">‚Üê Torna al negozio</button>
        </div>
    </div>
    
    <!-- CHECKOUT MODAL -->
    <div class="modal" id="checkoutModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìù Dati per la Consegna</h2>
                <button onclick="closeCheckout()">√ó</button>
            </div>
            <div class="form-group">
                <label>üë§ Nome Completo</label>
                <input type="text" id="custName" placeholder="Mario Rossi">
            </div>
            <div class="form-group">
                <label>üì± Telefono</label>
                <input type="tel" id="custPhone" placeholder="+39 123 456 7890">
            </div>
            <div class="form-group">
                <label>üìç Indirizzo di Consegna</label>
                <textarea id="custAddress" placeholder="Via Roma 123, Milano"></textarea>
            </div>
            <div class="form-group">
                <label>üìù Note (opzionale)</label>
                <textarea id="custNotes" placeholder="Orario preferito, campanello, ecc."></textarea>
            </div>
            <button class="btn btn-green" onclick="submitOrder()">üì¶ CONFERMA ORDINE</button>
            <button class="btn btn-gray" onclick="closeCheckout()">‚Üê Torna al carrello</button>
        </div>
    </div>
    
    <!-- SUCCESS MODAL -->
    <div class="modal" id="successModal">
        <div class="success-content">
            <div class="success-icon">üéâ</div>
            <div class="success-title">Ordine Inviato!</div>
            <div class="success-msg">Grazie per il tuo ordine!<br>Riceverai una conferma via WhatsApp.</div>
            <button class="btn btn-orange" onclick="closeSuccess()">üè† TORNA AL NEGOZIO</button>
        </div>
    </div>
    
    <!-- ADMIN MODAL -->
    <div class="modal" id="adminModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>‚öôÔ∏è Pannello Admin</h2>
                <button onclick="closeAdmin()">√ó</button>
            </div>
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="switchTab('orders')" id="tabOrders">üì¶ Ordini <span id="orderCount">0</span></button>
                <button class="tab-btn" onclick="switchTab('products')" id="tabProducts">üìù Prodotti</button>
            </div>
            
            <!-- ORDERS TAB -->
            <div id="ordersTab">
                <div id="ordersList"></div>
            </div>
            
            <!-- PRODUCTS TAB -->
            <div id="productsTab" style="display: none;">
                <div class="form-group">
                    <label>üì∑ Foto</label>
                    <div class="img-upload" onclick="document.getElementById('imgInput').click()">
                        <span id="imgPlaceholder">üì∑ Clicca per foto</span>
                        <img id="imgPreview" style="display:none;width:100%;height:100%;object-fit:cover;border-radius:12px;">
                    </div>
                    <input type="file" id="imgInput" accept="image/*" style="display:none" onchange="handleImg(event)">
                </div>
                <div class="form-group">
                    <label>üìù Nome Prodotto</label>
                    <input type="text" id="prodName" placeholder="Es. Pizza Margherita">
                </div>
                <div class="form-group">
                    <label>üè∑Ô∏è Categoria</label>
                    <input type="text" id="prodCat" placeholder="pizza, burger, drink, dessert">
                </div>
                <div class="form-group">
                    <label>üí∞ Prezzo (‚Ç¨)</label>
                    <input type="number" id="prodPrice" placeholder="8.00" step="0.01">
                </div>
                <div class="form-group">
                    <label>üìÑ Descrizione</label>
                    <textarea id="prodDesc" placeholder="Ingredienti, caratteristiche..."></textarea>
                </div>
                <button class="btn btn-orange" onclick="saveProduct()">üíæ SALVA PRODOTTO</button>
                <div class="product-list-admin" id="productListAdmin"></div>
            </div>
            
            <button class="btn btn-red" style="margin-top:20px" onclick="closeAdmin()">‚ùå CHIUDI</button>
        </div>
    </div>
    
    <script>
        const tg = Telegram.WebApp;
        tg.expand();
        
        const shopId = 'pizzaexpress';
        const PRODUCTS_KEY = 'shop_products_' + shopId;
        const ORDERS_KEY = 'shop_orders_' + shopId;
        
        let products = JSON.parse(localStorage.getItem(PRODUCTS_KEY) || '[]');
        let orders = JSON.parse(localStorage.getItem(ORDERS_KEY) || '[]');
        let cart = [];
        let editingIdx = null;
        let currentCat = 'all';
        
        // Default products
        if (products.length === 0) {
            products = [
                { name: 'Pizza Margherita', price: '7.00', cat: 'pizza', desc: 'Pomodoro, mozzarella, basilico fresco', img: 'https://images.unsplash.com/photo-1604068549290-dea0e4a305f4?w=300' },
                { name: 'Pizza Diavola', price: '8.50', cat: 'pizza', desc: 'Pomodoro, mozzarella, salame piccante', img: 'https://images.unsplash.com/photo-1628840042765-356cda07504e?w=300' },
                { name: 'Pizza Quattro Formaggi', price: '9.00', cat: 'pizza', desc: 'Mozzarella, gorgonzola, fontina, parmigiano', img: 'https://images.unsplash.com/photo-1513104890138-7c749659a591?w=300' },
                { name: 'Hamburger Classico', price: '8.00', cat: 'burger', desc: 'Carne 100%, formaggio, lattuga, pomodoro', img: 'https://images.unsplash.com/photo-1568901346375-23c9450c58cd?w=300' },
                { name: 'Cheeseburger', price: '9.00', cat: 'burger', desc: 'Carne, doppio formaggio, bacon croccante', img: 'https://images.unsplash.com/photo-1553979459-d2229ba7433b?w=300' },
                { name: 'Coca Cola', price: '3.00', cat: 'drink', desc: '33cl', img: 'https://images.unsplash.com/photo-1581006852262-e4307cf6283a?w=300' },
                { name: 'Sprite', price: '3.00', cat: 'drink', desc: '33cl', img: 'https://images.unsplash.com/photo-1527960471264-932f39eb5846?w=300' },
                { name: 'Tiramis√π', price: '5.00', cat: 'dessert', desc: 'Dolce tradizionale italiano', img: 'https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?w=300' }
            ];
            localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products));
        }
        
        function render() {
            const c = document.getElementById('products');
            const filtered = currentCat === 'all' ? products : products.filter(p => p.cat === currentCat);
            
            if (!filtered.length) {
                c.innerHTML = '<div class="empty">üì¶ Nessun prodotto</div>';
                return;
            }
            
            c.innerHTML = filtered.map((p, i) => `
                <div class="product" onclick="addToCart(${products.indexOf(p)})">
                    <img src="${p.img}" class="product-img" onerror="this.src='https://via.placeholder.com/300x200?text=Foto'">
                    <div class="product-info">
                        <div class="product-name">${p.name}</div>
                        <div class="product-desc">${p.desc || ''}</div>
                        <div class="product-bottom">
                            <div class="product-price">‚Ç¨${p.price}</div>
                            <button class="product-btn" onclick="event.stopPropagation();addToCart(${products.indexOf(p)})">+</button>
                        </div>
                    </div>
                </div>
            `).join('');
            renderProductListAdmin();
            updateOrderBadge();
        }
        
        function filterCat(cat) {
            currentCat = cat;
            document.querySelectorAll('.category').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            render();
        }
        
        function addToCart(i) {
            cart.push(products[i]);
            document.getElementById('cartCount').innerText = cart.length;
            tg.HapticFeedback.notificationOccurred('success');
        }
        
        function openCart() {
            if (!cart.length) return tg.showAlert('üõí Il carrello √® vuoto!');
            document.getElementById('cartModal').classList.add('active');
            renderCart();
        }
        
        function closeCart() {
            document.getElementById('cartModal').classList.remove('active');
        }
        
        function renderCart() {
            const container = document.getElementById('cartItems');
            if (!cart.length) {
                container.innerHTML = '<div class="empty-orders">üõí Carrello vuoto</div>';
                return;
            }
            container.innerHTML = cart.map((p, i) => `
                <div class="cart-item">
                    <div class="cart-item-info">
                        <div class="cart-item-name">${p.name}</div>
                        <div class="cart-item-price">‚Ç¨${p.price}</div>
                    </div>
                    <button style="background:#ef4444;color:#fff;padding:8px 12px;border:none;border-radius:8px;cursor:pointer;" onclick="removeFromCart(${i})">‚úï</button>
                </div>
            `).join('');
            const total = cart.reduce((s, p) => s + parseFloat(p.price), 0);
            document.getElementById('cartTotal').innerText = 'Totale: ‚Ç¨' + total.toFixed(2);
        }
        
        function removeFromCart(i) {
            cart.splice(i, 1);
            document.getElementById('cartCount').innerText = cart.length;
            renderCart();
        }
        
        function openCheckout() {
            closeCart();
            document.getElementById('checkoutModal').classList.add('active');
        }
        
        function closeCheckout() {
            document.getElementById('checkoutModal').classList.remove('active');
        }
        
        function submitOrder() {
            const name = document.getElementById('custName').value.trim();
            const phone = document.getElementById('custPhone').value.trim();
            const address = document.getElementById('custAddress').value.trim();
            const notes = document.getElementById('custNotes').value.trim();
            
            if (!name || !phone || !address) {
                tg.showAlert('‚ö†Ô∏è Compila tutti i campi obbligatori!');
                return;
            }
            
            const total = cart.reduce((s, p) => s + parseFloat(p.price), 0);
            const orderId = 'ORD-' + Date.now().toString(36).toUpperCase();
            
            const order = {
                id: orderId,
                products: [...cart],
                total: total,
                customer: { name, phone, address, notes },
                status: 'new',
                createdAt: new Date().toISOString()
            };
            
            orders.unshift(order);
            localStorage.setItem(ORDERS_KEY, JSON.stringify(orders));
            
            // Send notification
            const orderMsg = `üçï NUOVO ORDINE!\n\n` +
                `ID: ${orderId}\n` +
                `Cliente: ${name}\n` +
                `Tel: ${phone}\n` +
                `Indirizzo: ${address}\n\n` +
                `üõí PRODOTTI:\n` +
                cart.map(p => `‚Ä¢ ${p.name} - ‚Ç¨${p.price}`).join('\n') + `\n\n` +
                `üí∞ TOTALE: ‚Ç¨${total.toFixed(2)}`;
            
            try { tg.sendData(orderMsg); } catch(e) {}
            
            cart = [];
            document.getElementById('cartCount').innerText = '0';
            document.getElementById('custName').value = '';
            document.getElementById('custPhone').value = '';
            document.getElementById('custAddress').value = '';
            document.getElementById('custNotes').value = '';
            
            closeCheckout();
            document.getElementById('successModal').classList.add('active');
            updateOrderBadge();
        }
        
        function closeSuccess() {
            document.getElementById('successModal').classList.remove('active');
        }
        
        function openAdmin() {
            document.getElementById('adminModal').classList.add('active');
            renderOrders();
        }
        
        function closeAdmin() {
            document.getElementById('adminModal').classList.remove('active');
        }
        
        function switchTab(tab) {
            document.getElementById('tabOrders').classList.toggle('active', tab === 'orders');
            document.getElementById('tabProducts').classList.toggle('active', tab === 'products');
            document.getElementById('ordersTab').style.display = tab === 'orders' ? 'block' : 'none';
            document.getElementById('productsTab').style.display = tab === 'products' ? 'block' : 'none';
        }
        
        function renderOrders() {
            const container = document.getElementById('ordersList');
            document.getElementById('orderCount').innerText = orders.length;
            
            if (!orders.length) {
                container.innerHTML = '<div class="empty-orders">üì¶ Nessun ordine</div>';
                return;
            }
            
            container.innerHTML = orders.map((o, i) => {
                const statusClass = o.status === 'new' ? 'status-new' : o.status === 'processing' ? 'status-processing' : 'status-completed';
                const statusText = o.status === 'new' ? 'NUOVO' : o.status === 'processing' ? 'IN LAVORAZIONE' : 'COMPLETATO';
                const items = o.products.map(p => `${p.name} (‚Ç¨${p.price})`).join(', ');
                
                return `
                    <div class="order-card">
                        <div class="order-header">
                            <span class="order-id">${o.id}</span>
                            <span class="order-status ${statusClass}">${statusText}</span>
                        </div>
                        <div class="order-items">üõí ${items}</div>
                        <div class="order-customer">
                            <strong>üë§ ${o.customer.name}</strong><br>
                            üì± ${o.customer.phone}<br>
                            üìç ${o.customer.address}
                        </div>
                        <div class="cart-total" style="margin:10px 0;padding:12px;font-size:16px;">
                            üí∞ TOTALE: ‚Ç¨${o.total.toFixed(2)}
                        </div>
                        <div class="order-actions">
                            <button class="btn btn-blue" onclick="changeStatus(${i})">üîÑ Stato</button>
                            <button class="btn btn-red" onclick="deleteOrder(${i})">üóëÔ∏è</button>
                        </div>
                    </div>
                `;
            }).join('');
        }
        
        function changeStatus(i) {
            const statuses = ['new', 'processing', 'completed'];
            const current = statuses.indexOf(orders[i].status);
            orders[i].status = statuses[(current + 1) % statuses.length];
            localStorage.setItem(ORDERS_KEY, JSON.stringify(orders));
            renderOrders();
            updateOrderBadge();
        }
        
        function deleteOrder(i) {
            if(confirm('üóëÔ∏è Elimina ordine?')) {
                orders.splice(i, 1);
                localStorage.setItem(ORDERS_KEY, JSON.stringify(orders));
                renderOrders();
                updateOrderBadge();
            }
        }
        
        function updateOrderBadge() {
            const newOrders = orders.filter(o => o.status === 'new').length;
            document.getElementById('orderCount').innerText = orders.length;
        }
        
        function handleImg(e) {
            const f = e.target.files[0];
            if (f) {
                const r = new FileReader();
                r.onload = ev => {
                    document.getElementById('imgPreview').src = ev.target.result;
                    document.getElementById('imgPreview').style.display = 'block';
                    document.getElementById('imgPlaceholder').style.display = 'none';
                };
                r.readAsDataURL(f);
            }
        }
        
        function saveProduct() {
            const name = document.getElementById('prodName').value.trim();
            const price = document.getElementById('prodPrice').value.trim();
            const cat = document.getElementById('prodCat').value.trim();
            const desc = document.getElementById('prodDesc').value.trim();
            const img = document.getElementById('imgPreview').src || 'https://via.placeholder.com/300x200';
            
            if (!name || !price) return tg.showAlert('‚ö†Ô∏è Scrivi nome e prezzo!');
            
            if (editingIdx !== null) {
                products[editingIdx] = { name, price, cat, desc, img };
                editingIdx = null;
            } else {
                products.push({ name, price, cat, desc, img });
            }
            
            localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products));
            render();
            clearForm();
            tg.showAlert('‚úÖ Salvato!');
        }
        
        function renderProductListAdmin() {
            document.getElementById('productListAdmin').innerHTML = products.map((p, i) => `
                <div class="product-item">
                    <img src="${p.img}" onerror="this.src='https://via.placeholder.com/50'">
                    <div class="product-item-info">
                        <div class="product-item-name">${p.name}</div>
                        <div class="product-item-price">‚Ç¨${p.price}</div>
                    </div>
                    <div class="product-item-actions">
                        <button style="background:#3b82f6;color:#fff;" onclick="editProduct(${i})">‚úèÔ∏è</button>
                        <button style="background:#ef4444;color:#fff;" onclick="deleteProduct(${i})">üóëÔ∏è</button>
                    </div>
                </div>
            `).join('');
        }
        
        function editProduct(i) {
            editingIdx = i;
            document.getElementById('prodName').value = products[i].name;
            document.getElementById('prodPrice').value = products[i].price;
            document.getElementById('prodCat').value = products[i].cat || '';
            document.getElementById('prodDesc').value = products[i].desc || '';
            document.getElementById('imgPreview').src = products[i].img;
            document.getElementById('imgPreview').style.display = 'block';
            document.getElementById('imgPlaceholder').style.display = 'none';
            tg.showAlert('‚úèÔ∏è Modifica e SALVA');
        }
        
        function deleteProduct(i) {
            if(confirm('üóëÔ∏è Elimina prodotto?')) {
                products.splice(i, 1);
                localStorage.setItem(PRODUCTS_KEY, JSON.stringify(products));
                render();
            }
        }
        
        function clearForm() {
            document.getElementById('prodName').value = '';
            document.getElementById('prodPrice').value = '';
            document.getElementById('prodCat').value = '';
            document.getElementById('prodDesc').value = '';
            document.getElementById('imgPreview').src = '';
            document.getElementById('imgPreview').style.display = 'none';
            document.getElementById('imgPlaceholder').style.display = 'flex';
        }
        
        render();
    </script>
</body>
</html>
